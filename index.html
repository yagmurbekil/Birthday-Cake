<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>İyi ki Doğdun Özgür!</title>
    <style>
        body { 
            background-color: #fce4ec; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
            margin: 0; 
            font-family: 'Arial', sans-serif; 
            overflow: hidden; 
        }

        #instruction { 
            font-size: 2.2rem; 
            margin-bottom: 60px; 
            text-align: center; 
            color: #d81b60; 
            font-weight: bold;
            min-height: 5rem;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .cake-container { position: relative; display: flex; flex-direction: column; align-items: center; }

        .tier { 
            position: relative; 
            background: #fff; 
            border: 2px solid #f0f0f0; 
            display: flex; 
            justify-content: center;
            background-image: radial-gradient(#ff4081 3px, transparent 3px), radial-gradient(#448aff 3px, transparent 3px), radial-gradient(#ffeb3b 3px, transparent 3px);
            background-size: 30px 30px, 40px 40px, 50px 50px;
        }

        .top { width: 140px; height: 80px; z-index: 3; border-radius: 15px 15px 0 0; }
        .middle { width: 190px; height: 90px; z-index: 2; margin-top: -10px; border-radius: 10px; }
        .bottom { width: 240px; height: 100px; z-index: 1; margin-top: -10px; border-radius: 10px; }

        .icing { position: absolute; top: 0; width: 100%; height: 30px; border-radius: 10px 10px 0 0; }
        .pink { background: #f48fb1; border-bottom: 4px solid #f06292; }
        .gold { background: #ffd54f; border-bottom: 4px solid #fbc02d; }

        /* 8 Mum ve Alevler */
        .candles-box { position: absolute; top: -45px; width: 100%; display: flex; justify-content: space-evenly; z-index: 20; padding: 0 10px; box-sizing: border-box; }
        .candle { width: 10px; height: 45px; background: #fff; border-radius: 2px; position: relative; box-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
        .candle:nth-child(odd) { background: #ff80ab; }
        .candle:nth-child(even) { background: #81d4fa; }

        .flame { 
            position: absolute; top: -18px; left: 50%; transform: translateX(-50%); 
            width: 14px; height: 22px; background: orange; border-radius: 50% 50% 20% 20%; 
            box-shadow: 0 0 15px orange, 0 0 5px yellow; animation: flicker 0.1s infinite alternate; 
        }
        
        @keyframes flicker { from { transform: translateX(-50%) scale(1); } to { transform: translateX(-50%) scale(1.1); } }
        .off { display: none !important; }

        .plate { width: 300px; height: 15px; background: #eee; border-radius: 50%; margin-top: -5px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

    <div id="instruction">Sürpriz İçin Ekrana Dokun! 🎂</div>

    <div class="cake-container">
        <div class="tier top">
            <div class="icing pink"></div>
            <div class="candles-box">
                <div class="candle"><div class="flame"></div></div>
                <div class="candle"><div class="flame"></div></div>
                <div class="candle"><div class="flame"></div></div>
                <div class="candle"><div class="flame"></div></div>
                <div class="candle"><div class="flame"></div></div>
                <div class="candle"><div class="flame"></div></div>
                <div class="candle"><div class="flame"></div></div>
                <div class="candle"><div class="flame"></div></div>
            </div>
        </div>
        <div class="tier middle"><div class="icing pink"></div></div>
        <div class="tier bottom"><div class="icing gold"></div></div>
        <div class="plate"></div>
    </div>

    <script>
        const instruction = document.getElementById('instruction');
        const flames = document.querySelectorAll('.flame');
        let isBlown = false;

        async function initAudio() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                const audioContext = new AudioContext();
                const analyser = audioContext.createAnalyser();
                const source = audioContext.createMediaStreamSource(stream);
                source.connect(analyser);
                const dataArray = new Uint8Array(analyser.frequencyBinCount);

                instruction.innerHTML = "3... 2... 1... ÜFLE! 🌬️";

                function checkVolume() {
                    if (!isBlown) {
                        analyser.getByteFrequencyData(dataArray);
                        let sum = 0;
                        for(let i = 0; i < dataArray.length; i++) sum += dataArray[i];
                        let average = sum / dataArray.length;

                        if (average > 40) { // Üfleme şiddeti
                            extinguish();
                        }
                    }
                    requestAnimationFrame(checkVolume);
                }
                checkVolume();
            } catch (err) {
                instruction.innerHTML = "Mikrofon izni verilmedi!";
            }
        }

        function extinguish() {
            isBlown = true;
            flames.forEach(f => f.classList.add('off'));
            instruction.innerHTML = "DOĞUM GÜNÜN KUTLU OLSUN <br>ÖZGÜR SENİ ÇOK SEVİYORUM! ❤️";
            
            // 5 saniye sonra mumları tekrar yak
            setTimeout(() => {
                flames.forEach(f => f.classList.remove('off'));
                instruction.innerHTML = "Hadi Bir Daha Üfle! ✨";
                isBlown = false;
            }, 5000);
        }

        window.onclick = () => {
            if (instruction.innerText.includes("Dokun")) {
                initAudio();
            }
        };
    </script>
</body>
</html>
